<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Label Stats</title>
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    
    <style>
        
        body {
            padding-top: 20px;
            padding-bottom: 60px;
        }
        
        h2.text-center small {  
            display: block;
            margin-top: 12px;
        }
    
    </style>
</head>
<body>
    
    <div class="container">
        
        <div class="row">
            
            <div class="col-md-12">
                <h2 class="text-center"><span id="path"></span> <br> <small>total images: <span id="total_images">300000</span></small></h2>
                <br>
                <table class="table">

                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Label</th>
                            <th>Occurence (%)</th>
                            <th>Avg. Score</th>
                            <th>Min. Score</th>
                            <th>Max. Score</th>
                        </tr>
                    </thead>

                    <tbody id="table_body">
                        
                    </tbody>

                </table>
            </div>
        </div>
        
    </div>
    
    <script src="assets/js/jquery-1.12.4.min.js"></script>
    <script>
        
        var data = 
        {    
            dir_path: "/Users/riandyrn/coba_download_s3/non_violate_image",
            images: 
            [
                {
                    path: '/Users/riandyrn/coba_download_s3/non_violate_image/581x1032-1_-58e8b396e0c33.jpg', 
                    rekognition_result: '[ { "Confidence": 94.30461120605469, "Name": "Brochure" }, { "Confidence": 94.30461120605469, "Name": "Flyer" }, { "Confidence": 94.30461120605469, "Name": "Poster" }, { "Confidence": 89.54283142089844, "Name": "Art" }, { "Confidence": 89.54283142089844, "Name": "Graphic Design" } ]',
                    google_labels: '[ { "mid": "/m/04rky", "description": "mammal", "score": 0.9205843 }, { "mid": "/m/09686", "description": "vertebrate", "score": 0.90285283 }, { "mid": "/m/04cmwn", "description": "goats", "score": 0.87997764 }, { "mid": "/m/035qhg", "description": "fauna", "score": 0.8455444 }, { "mid": "/m/03fwl", "description": "goat", "score": 0.84269863 } ]',
                    is_violating_image: true,
                    recognized_label: "Brochure"
                },
                {
                    path: '/Users/riandyrn/coba_download_s3/subset_clean_dataset/900x900-1_-aE1eta0COTeRc8.jpg', 
                    rekognition_result: '[ { "Confidence": 94.30461120605469, "Name": "Brochure" }, { "Confidence": 94.30461120605469, "Name": "Flyer" }, { "Confidence": 94.30461120605469, "Name": "Poster" }, { "Confidence": 89.54283142089844, "Name": "Art" }, { "Confidence": 89.54283142089844, "Name": "Graphic Design" } ]',
                    google_labels: '[ { "mid": "/m/04rky", "description": "mammal", "score": 0.9205843 }, { "mid": "/m/09686", "description": "vertebrate", "score": 0.90285283 }, { "mid": "/m/04cmwn", "description": "goats", "score": 0.87997764 }, { "mid": "/m/035qhg", "description": "fauna", "score": 0.8455444 }, { "mid": "/m/03fwl", "description": "goat", "score": 0.84269863 } ]',
                    is_violating_image: true,
                    recognized_label: "Brochure"
                },
                {
                    path: '/Users/riandyrn/coba_download_s3/subset_clean_dataset/607x1080-1_-58fb0bde0a57a.JPG', 
                    rekognition_result: '[ { "Confidence": 94.30461120605469, "Name": "Brochure" }, { "Confidence": 94.30461120605469, "Name": "Flyer" }, { "Confidence": 94.30461120605469, "Name": "Poster" }, { "Confidence": 89.54283142089844, "Name": "Art" }, { "Confidence": 89.54283142089844, "Name": "Graphic Design" } ]',
                    google_labels: '[ { "mid": "/m/04rky", "description": "mammal", "score": 0.9205843 }, { "mid": "/m/09686", "description": "vertebrate", "score": 0.90285283 }, { "mid": "/m/04cmwn", "description": "goats", "score": 0.87997764 }, { "mid": "/m/035qhg", "description": "fauna", "score": 0.8455444 }, { "mid": "/m/03fwl", "description": "goat", "score": 0.84269863 } ]',
                    is_violating_image: true,
                    recognized_label: "Brochure"
                },
                {
                    path: '/Users/riandyrn/coba_download_s3/subset_clean_dataset/900x900-1_-5DAXUC00aJ3123.jpg', 
                    rekognition_result: '[ { "Confidence": 94.30461120605469, "Name": "Brochure" }, { "Confidence": 94.30461120605469, "Name": "Flyer" }, { "Confidence": 94.30461120605469, "Name": "Poster" }, { "Confidence": 89.54283142089844, "Name": "Art" }, { "Confidence": 89.54283142089844, "Name": "Graphic Design" } ]',
                    google_labels: '[ { "mid": "/m/04rky", "description": "mammal", "score": 0.9205843 }, { "mid": "/m/09686", "description": "vertebrate", "score": 0.90285283 }, { "mid": "/m/04cmwn", "description": "goats", "score": 0.87997764 }, { "mid": "/m/035qhg", "description": "fauna", "score": 0.8455444 }, { "mid": "/m/03fwl", "description": "goat", "score": 0.84269863 } ]',
                    is_violating_image: true,
                    recognized_label: "Brochure"
                },
                {
                    path: '/Users/riandyrn/coba_download_s3/subset_clean_dataset/900x674-1_-58fb066e0dbff.jpg', 
                    rekognition_result: '[ { "Confidence": 94.30461120605469, "Name": "Brochure" }, { "Confidence": 94.30461120605469, "Name": "Flyer" }, { "Confidence": 94.30461120605469, "Name": "Poster" }, { "Confidence": 89.54283142089844, "Name": "Art" }, { "Confidence": 89.54283142089844, "Name": "Graphic Design" } ]',
                    google_labels: '[ { "mid": "/m/04rky", "description": "mammal", "score": 0.9205843 }, { "mid": "/m/09686", "description": "vertebrate", "score": 0.90285283 }, { "mid": "/m/04cmwn", "description": "goats", "score": 0.87997764 }, { "mid": "/m/035qhg", "description": "fauna", "score": 0.8455444 }, { "mid": "/m/03fwl", "description": "goat", "score": 0.84269863 } ]',
                    is_violating_image: true,
                    recognized_label: "Brochure"
                }
            ],
            total_images: 309000,
            num_violating_images: 904
        };
        
        // convert raw data to array of label object: [{automobile: 10.0, car: 20.0}]
        var label_objs = [];
        var images = data.images;
        
        for(var i = 0; i < images.length; i++) {
            
            var label_obj = {};
            
            var aws_labels = JSON.parse(images[i].rekognition_result);
            var google_labels = JSON.parse(images[i].google_labels);
            
            // load aws labels
            for(var j = 0; j < aws_labels.length; j++) {
                
                var label = aws_labels[j]['Name'].toLowerCase();
                var score = aws_labels[j]['Confidence'];
                
                label_obj[label] = score;
            }
            
            // load google labels
            for(var j = 0; j < google_labels.length; j++) {
                
                var label = google_labels[j]['description'].toLowerCase();
                var score = google_labels[j]['score'] * 100;
                
                if(label_obj[label]) {
                    label_obj[label] = Math.max(label_obj[label], score);
                } else {
                    label_obj[label] = score;
                }
                
            }
            
            label_objs.push(label_obj);
        }
        
        //console.log(label_objs);
        
        // process array of label object to object of data: {brochure: {name: 'brochure', occurrence: 5, max_score: 10.0, min_score: 5.0, sum_score: 15.0}, art: {}, ...}
        var stats_data = {};
        for(var i = 0; i < label_objs.length; i++) {
            
            var label_obj = label_objs[i];
            
            for(key in label_obj) {
                
                var score = label_obj[key];
                if(key in stats_data) {
                    
                    var row = stats_data[key];
                    
                    row['occurrence']++;
                    row['sum_score'] += score;
                    row['min_score'] = Math.min(row['min_score'], score);
                    row['max_score'] = Math.max(row['max_score'], score);
                } 
                else
                    stats_data[key] = {occurrence: 1, sum_score: score, min_score: score, max_score: score};
            }
        }
        
        //console.log(stats_data);
        
        // fill path & total_images
        $('#path').text(data.dir_path);
        $('#total_images').text(data.total_images);
        
        // transfer to array so it could be sorted
        stats_arr = [];
        for(key in stats_data) {
            
            var obj = stats_data[key];
            obj['name'] = key;
            
            stats_arr.push(obj);
        }
        
        // sort array
        stats_arr.sort((a, b) => { return b.occurrence - a.occurrence; });
        
        // append to #table_body
        var table_body = $('#table_body');
        var total_data = images.length;
        var num_decimal_digits = 4;
        
        for(var i = 0; i < stats_arr.length; i++) {
            
            var row = stats_arr[i];
            
            var name = row['name'];
            var percentage_occurrence = (row['occurrence'] * 100 / total_data).toFixed(2);
            var average_score = (row['sum_score'] / total_data).toFixed(num_decimal_digits);
            var min_score = row['min_score'].toFixed(num_decimal_digits);
            var max_score = row['max_score'].toFixed(num_decimal_digits);
            
            table_body.append('<tr> <td>' + (i + 1) + '.</td> <td>' + name + '</td> <td>' + percentage_occurrence + '%</td> <td>' + average_score + '</td> <td>' + min_score + '</td> <td>' + max_score + '</td> </tr>');
        }
        
    </script>
</body>
</html>